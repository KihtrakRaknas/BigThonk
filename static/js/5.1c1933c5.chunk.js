(this["webpackJsonpbig-thonk"]=this["webpackJsonpbig-thonk"]||[]).push([[5],{326:function(e,t,i){"use strict";i.r(t);var s,a=i(116),n=i(1),r=i(2),o=i(348),h=i(347),d=i(349),c=i(4),l=i(3),u=function(){function e(){Object(n.a)(this,e),this.registry_={}}return Object(r.a)(e,[{key:"on",value:function(e,t){this.getRegistry_(e).push(t)}},{key:"off",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(e&&t){var i=this.getRegistry_(e),s=i.indexOf(t);s>-1&&i.splice(s,1)}else this.registry_={}}},{key:"emit",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.getRegistry_(e).forEach((function(e){return e.apply(void 0,i)}))}},{key:"getEventCount",value:function(){var e=this,t=0;return Object.keys(this.registry_).forEach((function(i){t+=e.getRegistry_(i).length})),t}},{key:"getRegistry_",value:function(e){return this.registry_[e]=this.registry_[e]||[]}}]),e}(),v=i(346),g="autotrack",b={},f=!1,y=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e){var s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n.a)(this,i),(s=t.call(this)).key_=e,s.defaults_=a,s.cache_=null,s}return Object(r.a)(i,null,[{key:"getOrCreate",value:function(e,t,s){var a=[g,e,t].join(":");return b[a]||(b[a]=new i(a,s),f||(window.addEventListener("storage",m),f=!0)),b[a]}},{key:"isSupported_",value:function(){if(null!=s)return s;try{window.localStorage.setItem(g,g),window.localStorage.removeItem(g),s=!0}catch(e){s=!1}return s}},{key:"get_",value:function(e){return window.localStorage.getItem(e)}},{key:"set_",value:function(e,t){window.localStorage.setItem(e,t)}},{key:"clear_",value:function(e){window.localStorage.removeItem(e)}}]),Object(r.a)(i,[{key:"get",value:function(){if(this.cache_)return this.cache_;if(i.isSupported_())try{this.cache_=k(i.get_(this.key_))}catch(e){}return this.cache_=Object(v.a)({},this.defaults_,this.cache_)}},{key:"set",value:function(e){if(this.cache_=Object(v.a)({},this.defaults_,this.cache_,e),i.isSupported_())try{i.set_(this.key_,JSON.stringify(this.cache_))}catch(t){}}},{key:"clear",value:function(){if(this.cache_={},i.isSupported_())try{i.clear_(this.key_)}catch(e){}}},{key:"destroy",value:function(){delete b[this.key_],Object.keys(b).length||(window.removeEventListener("storage",m),f=!1)}}]),i}(u);function m(e){var t=b[e.key];if(t){var i=Object(v.a)({},t.defaults_,k(e.oldValue)),s=Object(v.a)({},t.defaults_,k(e.newValue));t.cache_=s,t.emit("externalSet",s,i)}}function k(e){var t={};if(e)try{t=JSON.parse(e)}catch(i){}return t}var p={},O=function(){function e(t,i,s){Object(n.a)(this,e),this.tracker=t,this.timeout=i||e.DEFAULT_TIMEOUT,this.timeZone=s,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),h.a.add(t,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(a){}this.store=y.getOrCreate(t.get("trackingId"),"session",{hitTime:0,isExpired:!1}),this.store.get().id||this.store.set({id:Object(v.h)()})}return Object(r.a)(e,null,[{key:"getOrCreate",value:function(t,i,s){var a=t.get("trackingId");return p[a]?p[a]:p[a]=new e(t,i,s)}}]),Object(r.a)(e,[{key:"getId",value:function(){return this.store.get().id}},{key:"isExpired",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getId();if(e!=this.getId())return!0;var t=this.store.get();if(t.isExpired)return!0;var i=t.hitTime;if(i){var s=new Date,a=new Date(i);if(s-a>6e4*this.timeout||this.datesAreDifferentInTimezone(s,a))return!0}return!1}},{key:"datesAreDifferentInTimezone",value:function(e,t){return!!this.dateTimeFormatter&&this.dateTimeFormatter.format(e)!=this.dateTimeFormatter.format(t)}},{key:"sendHitTaskOverride",value:function(e){var t=this;return function(i){e(i);var s=i.get("sessionControl"),a="start"==s||t.isExpired(),n="end"==s,r=t.store.get();r.hitTime=Object(v.g)(),a&&(r.isExpired=!1,r.id=Object(v.h)()),n&&(r.isExpired=!0),t.store.set(r)}}},{key:"destroy",value:function(){h.a.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete p[this.tracker.get("trackingId")]}}]),e}();O.DEFAULT_TIMEOUT=30;var T=i(350),_="visible",S=Object(v.h)(),I=function(){function e(t,i){var s=this;if(Object(n.a)(this,e),Object(T.b)(t,T.a.PAGE_VISIBILITY_TRACKER),document.visibilityState){var a={sessionTimeout:O.DEFAULT_TIMEOUT,visibleThreshold:5e3,sendInitialPageview:!1,fieldsObj:{}};this.opts=Object(v.a)(a,i),this.tracker=t,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=y.getOrCreate(t.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=O.getOrCreate(t,this.opts.sessionTimeout,this.opts.timeZone),h.a.add(t,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),Object(v.d)(this.tracker,(function(){document.visibilityState==_?(s.opts.sendInitialPageview&&(s.sendPageview({isPageLoad:!0}),s.isInitialPageviewSent_=!0),s.store.set({time:Object(v.g)(),state:_,pageId:S,sessionId:s.session.getId()})):s.opts.sendInitialPageview&&s.opts.pageLoadsMetricIndex&&s.sendPageLoad()}))}}return Object(r.a)(e,[{key:"handleChange",value:function(){var e=this;if(document.visibilityState==_||"hidden"==document.visibilityState){var t=this.getAndValidateChangeData(),i={time:Object(v.g)(),state:document.visibilityState,pageId:S,sessionId:this.session.getId()};document.visibilityState==_&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),"hidden"==document.visibilityState&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(t.sessionId)?(this.store.clear(),"hidden"==this.lastPageState&&document.visibilityState==_&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout((function(){e.store.set(i),e.sendPageview({hitTime:i.time})}),this.opts.visibleThreshold))):(t.pageId==S&&t.state==_&&this.sendPageVisibilityEvent(t),this.store.set(i)),this.lastPageState=document.visibilityState}}},{key:"getAndValidateChangeData",value:function(){var e=this.store.get();return this.lastPageState==_&&"hidden"==e.state&&e.pageId!=S&&(e.state=_,e.pageId=S,this.store.set(e)),e}},{key:"sendPageVisibilityEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.hitTime,s=this.getTimeSinceLastStoredChange(e,{hitTime:i});if(s&&s>=this.opts.visibleThreshold){var a=Math.round(s/1e3),n={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:a,eventLabel:o.b};i&&(n.queueTime=Object(v.g)()-i),this.opts.visibleMetricIndex&&(n["metric"+this.opts.visibleMetricIndex]=a),this.tracker.send("event",Object(v.c)(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}},{key:"sendPageLoad",value:function(){var e,t=(e={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:o.b},Object(a.a)(e,"metric"+this.opts.pageLoadsMetricIndex,1),Object(a.a)(e,"nonInteraction",!0),e);this.tracker.send("event",Object(v.c)(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},{key:"sendPageview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hitTime,i=e.isPageLoad,s={transport:"beacon"};t&&(s.queueTime=Object(v.g)()-t),i&&this.opts.pageLoadsMetricIndex&&(s["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",Object(v.c)(s,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},{key:"trackerSetOverride",value:function(e){var t=this;return function(i,s){var n=Object(v.f)(i)?i:Object(a.a)({},i,s);n.page&&n.page!==t.tracker.get("page")&&t.lastPageState==_&&t.handleChange(),e(i,s)}}},{key:"getTimeSinceLastStoredChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.hitTime;return e.time?(i||Object(v.g)())-e.time:0}},{key:"handleExternalStoreSet",value:function(e,t){e.time!=t.time&&(t.pageId!=S||t.state!=_||this.session.isExpired(t.sessionId)||this.sendPageVisibilityEvent(t,{hitTime:e.time}))}},{key:"handleWindowUnload",value:function(){"hidden"!=this.lastPageState&&this.handleChange()}},{key:"remove",value:function(){this.store.destroy(),this.session.destroy(),h.a.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}}]),e}();Object(d.a)("pageVisibilityTracker",I)}}]);
//# sourceMappingURL=5.1c1933c5.chunk.js.map